<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs
    title="gCalBirthdays"
    title_url="http://gcalbirthdays.googlecode.com"
    author="Frank Glaser"
    author_email="GlaserFrank@gmail.com"
    height="100"
    scrolling="true">
    <Require feature="dynamic-height"/>
    <Require feature="setprefs"/>
    <Optional feature="google.calendar-0.5"/>
    <Optional feature="google.calendar-0.5.read"/>
    <OAuth>
      <Service name="gCalBirthdays">
        <Access url="https://www.google.com/accounts/OAuthGetAccessToken" method="GET" />
        <Request url="https://www.google.com/accounts/OAuthGetRequestToken?scope=http://www.google.com/m8/feeds/%20http://www.google.com/calendar/feeds/" method="GET" />
        <Authorization url="https://www.google.com/accounts/OAuthAuthorizeToken?oauth_callback=http://oauth.gmodules.com/gadgets/oauthcallback" />
      </Service>
    </OAuth>
    <UserPref name="test" display_name="Color" default_value="Yellow" datatype="hidden"/>
  </ModulePrefs>
  <Content type="html">
    <![CDATA[

      <!--http://code.google.com/p/gdata-javascript-client/-->
      <!--V1.10-->
      <!--http://www.google.com/uds/modules/gdata/gdata.js-->
      <script type="text/javascript" src="http://www.google.com/jsapi"></script>
      <!--script type="text/javascript" src="http://www.google.com/jsapi?autoload=%7Bmodules%3A%5B%7Bname%3Agdata%2Cversion%3A1.x%2Cpackages%3A%5Bcontacts%2Ccalendar%5D%7D%5D%7D"></script-->

      <!--http://www.prototypejs.org/-->
      <!--V1.6.0.3-->
      <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/prototype/1.6.0.3/prototype.js"></script>
      <!--adjustheight workaround: http://code.google.com/p/opensocial-resources/issues/detail?id=104-->
      <script type="text/javascript">Array.prototype.toJSON = null;</script>

      <!--http://www.bram.us/projects/js_bramus/jsprogressbarhandler/-->
      <!--V0.3.3-->
      <!--http://www.bram.us/demo/projects/jsprogressbarhandler/js/bramus/jsProgressBarHandler.js-->
      <script type="text/javascript" src="http://gcalbirthdays.googlecode.com/svn/trunk/gCalBirthdays/JS/jsProgressBarHandler.js"></script>

      <!--http://phpjs.org/packages/view/396/name:7d67fb58ff9ab58f4d0e4e55221b50e7/-->
      <!--V2.8.6-->
      <!--http://phpjs.org/packages/download/396/name:html_funcs.min.js-->
      <script type="text/javascript" src="http://gcalbirthdays.googlecode.com/svn/trunk/gCalBirthdays/JS/html_funcs.min.js"></script>

      <!--shindig oauth popup handling code-->
      <!--SVN140-->
      <!--http://code.google.com/p/gdata-samples/source/browse/trunk/gadgets/popup.js-->
      <script type="text/javascript" src="http://gcalbirthdays.googlecode.com/svn/trunk/gCalBirthdays/JS/popup.js"></script>

      <!--gCalBirthay Javascript functions for HTML and Gadget Version-->
      <!--V1.12-->
      <script type="text/javascript" src="http://gcalbirthdays.googlecode.com/svn/trunk/gCalBirthdays/JS/gCalBirthdays.js"></script>

      <!--gCalBirthay Gadget specific Javascript functions-->
      <script type="text/javascript">

        //IE JScript 5.6 Compatibility
        // Constants
        var APP_VERSION = '2.064';
        var MAX_HEIGHT = 300;

        // The gadget containers request that we do NOT run any JS inline.
        // Instead, register a callback handler.
        gadgets.util.registerOnLoadHandler(initGadget);

        function initGadget() {
          // Load the Google data JS Client Library
          //google.load('gdata', '1.x');
          // Save overhead, only load the necessary service
          google.load("gdata", "1.x", {packages: ['contacts', 'calendar']});

          // Tells the google JS lib to call the init function once loaded
          google.setOnLoadCallback(setupGadget);
        }

        function setupGadget(){
          myService = new google.gdata.calendar.CalendarService(APP_NAME);
          myService.useOAuth(APP_NAME);

          setupService();
          useOAuth();

          $('version').innerHTML = /*APP_NAME + ' ' +*/ 'Version: ' + APP_VERSION;
          showOneSection('main');
        };

        function showSettings() {
          showOneSection('busyloader');
          queryGroupsAndCalendars();
        }

        function onclickSave() {
          setPreferences();
          gadgets.window.adjustHeight();
          //showOneSection('main');
        }

        function onclickCancel() {
          showOneSection('main');
        }

        function getPreferences() {
          // get saved data
        }

        function setPreferences() {
          // save data
        }

        function showOneSection(toshow) {
          var sections = [ 'main', 'approval', 'waiting', 'busyloader', 'settings' ];
          for (var i=0; i < sections.length; ++i) {
            var s = sections[i];
            var el = $(s);
            if (s === toshow) {
              el.style.display = "block";
            } else {
              el.style.display = "none";
            }
          }
          adjustHeight();
        }

        /**
         * Adjust the height of the gadget
         */
        function adjustHeight() {
          var sections = $('sections');
          sections.removeAttribute('style');

          var height = nodeHeight($('gadget'));
          if ( MAX_HEIGHT < height) {
            height = MAX_HEIGHT;

            // Put a scrollbar back on the gadget.
            sections.style.height = height - nodeHeight($('logo'));
            sections.style.overflowY = 'scroll';
          }
          gadgets.window.adjustHeight(height);
        }
      </script>

      <style type="text/css">
        #settings {
          font-size: 12px;
          color: red;
        }

        #settingslink {
          cursor: pointer;
          font-size: 12px;
          text-decoration: underline;
          color: blue;
          float: right;
        }

        div {
          font-size: 12px;
        }
      </style>

      <div id="gadget">
        <img id='logo' src="http://gcalbirthdays.googlecode.com/svn/trunk/gCalBirthdays/Gadget/gCalBirthdays.gif" alt="gCalBirthdays Logo"/>

        <div id="sections">
          <div id="main" style="display:none">
            <span id="version">Version</span>
            <span id="settingslink" onclick="showSettings()">settings</span>
          </div>

          <div id="approval" style="display:none">
            <img src="http://gcalbirthdays.googlecode.com/svn/trunk/gCalBirthdays/Images/popup.gif">
            <a href="#" id="personalize">Login</a>
          </div>

          <div id="waiting" style="display:none">
            Please click
            <a href="#" id="approvaldone">I've approved access</a>
            once you've approved access to your data.
          </div>

          <div id="busyloader" style="display:none">
            <img src="http://gcalbirthdays.googlecode.com/svn/trunk/gCalBirthdays/Images/busyLoader.gif" alt="BusyLoader Image">
          </div>

          <div id="settings" style="display:none">
            <table>
              <tr>
                <td id="text">Set Reminder:</td>
              </tr>
              <tr>
                <td id="text">
                  <input id="reminderinput" maxlength="2" style="width:30px" onkeypress="return isNumberKey(event)"/>
                  day(s)
                </td>
              </tr>
              <tr>
                <td id="text">Select Group(s):</td>
              </tr>
              <tr>
                <td>
                  <select id="groupselect" multiple="multiple" size="4"></select>
                </td>
              </tr>
              <tr>
                <td id="text">Select Calendar:</td>
              </tr>
              <tr>
                <td>
                  <select id="calendarselect" size="1" onchange="changeCalendar()"></select>
                </td>
              </tr>
            </table>
            <input id="save" type="button" value="Save" onclick="onclickSave()">
            <input id="cancel" type="button" value="Cancel" onclick="onclickCancel()">
          </div>
          <div id="progress" style="display:none">
            <table>
              <tr>
                <td>Load Contacts:</td>
                <td><span id="contactsprogressbar">0%</span></td>
              </tr>
              <tr>
                <td>Load Events:</td>
                <td><span id="eventsprogressbar" class="progressBar">0%</span></td>
              </tr>
              <tr>
                <td>Transfer Birthdays:</td>
                <td><span id="transferprogressbar" class="progressBar">0%</span></td>
              </tr>
            </table>
          </div>
        </div>
      </div>

      <!--Google Analytics-->
      <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      </script>
      <script type="text/javascript">
        try {
          var pageTracker = _gat._getTracker("UA-9798979-1");
          pageTracker._trackPageview();
        }
        catch(err) {}
      </script>

    ]]>
  </Content>
</Module>
